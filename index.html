<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>港股佣金计算器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .calculator {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
        }
        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .market-selector {
            margin-bottom: 20px;
            text-align: center;
        }
        .market-selector label {
            margin: 0 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="market-selector">
            <label>
                <input type="radio" name="market" value="hk" checked onchange="switchMarket('hk')"> 港股
            </label>
            <label>
                <input type="radio" name="market" value="cn" onchange="switchMarket('cn')"> A股
            </label>
        </div>
        <h2 id="marketTitle">港股佣金计算器</h2>
        <div class="input-group">
            <label for="buyPrice">买入价格（港元）:</label>
            <input type="number" id="buyPrice" step="0.001" placeholder="请输入买入价格">
        </div>
        <div class="input-group">
            <label for="sellPrice">卖出价格（港元）:</label>
            <input type="number" id="sellPrice" step="0.001" placeholder="请输入卖出价格">
        </div>
        <div class="input-group">
            <label for="shares">股数:</label>
            <input type="number" id="shares" step="100" min="100" placeholder="请输入股票数量（100的整数倍）">
        </div>
        <div class="input-group">
            <label>买入金额：<span id="buyAmount">0.00</span> 港元</label>
        </div>
        <div class="input-group">
            <label>卖出金额：<span id="sellAmount">0.00</span> 港元</label>
        </div>
        <button onclick="calculateProfit()">计算盈亏</button>
        <div class="result" id="result"></div>
    </div>

    <script>
        let currentMarket = 'hk';

        function switchMarket(market) {
            currentMarket = market;
            document.getElementById('marketTitle').textContent = 
                market === 'hk' ? '港股佣金计算器' : 'A股佣金计算器';
            
            // 清空输入和结果
            document.getElementById('buyPrice').value = '';
            document.getElementById('sellPrice').value = '';
            document.getElementById('shares').value = '';
            document.getElementById('buyAmount').textContent = '0.00';
            document.getElementById('sellAmount').textContent = '0.00';
            document.getElementById('result').innerHTML = '';
        }

        function calculateProfit() {
            if (currentMarket === 'hk') {
                calculateHKProfit();
            } else {
                calculateCNProfit();
            }
        }

        // 当输入改变时实时计算总金额
        document.getElementById('buyPrice').addEventListener('input', updateAmount);
        document.getElementById('sellPrice').addEventListener('input', updateAmount);
        document.getElementById('shares').addEventListener('input', updateAmount);

        function updateAmount() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value) || 0;
            const sellPrice = parseFloat(document.getElementById('sellPrice').value) || 0;
            const shares = parseInt(document.getElementById('shares').value) || 0;
            document.getElementById('buyAmount').textContent = (buyPrice * shares).toFixed(2);
            document.getElementById('sellAmount').textContent = (sellPrice * shares).toFixed(2);
        }

        function calculateHKProfit() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const shares = parseInt(document.getElementById('shares').value);
            
            if (isNaN(buyPrice) || isNaN(sellPrice) || isNaN(shares) || 
                buyPrice <= 0 || sellPrice <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的买入价、卖出价和股数（股数必须是100的整数倍）');
                return;
            }

            const buyAmount = buyPrice * shares;
            const sellAmount = sellPrice * shares;

            // 计算买入费用
            const buyCommission = Math.max(buyAmount * 0.0003, 3); // 佣金
            const buyPlatformFee = 15; // 平台使用费
            const buyTradingFee = Math.max(buyAmount * 0.00005650, 0.01); // 交易费
            const buyStampDuty = Math.ceil(buyAmount * 0.001); // 印花税
            const buyTransferFee = Math.min(Math.max(buyAmount * 0.00002, 2), 100); // 交收费
            const buySfcLevyFee = Math.max(buyAmount * 0.000027, 0.01); // 证监会征费
            const buyFrcLevyFee = buyAmount * 0.0000015; // 财汇局征费
            
            // 计算卖出费用
            const sellCommission = Math.max(sellAmount * 0.0003, 3); // 佣金
            const sellPlatformFee = 15; // 平台使用费
            const sellTradingFee = Math.max(sellAmount * 0.00005650, 0.01); // 交易费
            const sellStampDuty = Math.ceil(sellAmount * 0.001); // 印花税
            const sellTransferFee = Math.min(Math.max(sellAmount * 0.00002, 2), 100); // 交收费
            const sellSfcLevyFee = Math.max(sellAmount * 0.000027, 0.01); // 证监会征费
            const sellFrcLevyFee = sellAmount * 0.0000015; // 财汇局征费

            const totalBuyFees = buyCommission + buyPlatformFee + buyTradingFee + 
                                buyStampDuty + buyTransferFee + buySfcLevyFee + buyFrcLevyFee;
            
            const totalSellFees = sellCommission + sellPlatformFee + sellTradingFee + 
                                 sellStampDuty + sellTransferFee + sellSfcLevyFee + sellFrcLevyFee;

            const totalCost = buyAmount + totalBuyFees;
            const totalRevenue = sellAmount - totalSellFees;
            const profit = totalRevenue - totalCost;

            // 显示结果
            const result = document.getElementById('result');
            result.innerHTML = `
                <h3>交易分析</h3>
                <h4>买入详情：</h4>
                <p>买入金额：${buyAmount.toFixed(2)} 港元</p>
                <p>买入费用：${totalBuyFees.toFixed(2)} 港元</p>
                <p>买入成本：${totalCost.toFixed(2)} 港元</p>
                <h4>卖出详情：</h4>
                <p>卖出金额：${sellAmount.toFixed(2)} 港元</p>
                <p>卖出费用：${totalSellFees.toFixed(2)} 港元</p>
                <p>实际所得：${totalRevenue.toFixed(2)} 港元</p>
                <h4>盈亏结果：${profit.toFixed(2)} 港元 (${((profit/totalCost) * 100).toFixed(2)}%)</h4>
            `;
        }

        function calculateCNProfit() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const shares = parseInt(document.getElementById('shares').value);
            
            if (isNaN(buyPrice) || isNaN(sellPrice) || isNaN(shares) || 
                buyPrice <= 0 || sellPrice <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的买入价、卖出价和股数（股数必须是100的整数倍）');
                return;
            }

            const buyAmount = buyPrice * shares;
            const sellAmount = sellPrice * shares;

            // 计算买入费用
            const buyFees = calculateAStockFees(buyAmount, 'buy');
            // 计算卖出费用
            const sellFees = calculateAStockFees(sellAmount, 'sell');

            const totalBuyFees = parseFloat(buyFees.total);
            const totalSellFees = parseFloat(sellFees.total);
            
            const totalCost = buyAmount + totalBuyFees;
            const totalRevenue = sellAmount - totalSellFees;
            const profit = totalRevenue - totalCost;

            // 显示结果
            const result = document.getElementById('result');
            result.innerHTML = `
                <h3>交易分析</h3>
                <h4>买入详情：</h4>
                <p>买入金额：${buyAmount.toFixed(2)} 元</p>
                <p>买入佣金：${buyFees.commission} 元</p>
                <p>过户费：${buyFees.transferFee} 元</p>
                <p>买入成本：${totalCost.toFixed(2)} 元</p>
                <h4>卖出详情：</h4>
                <p>卖出金额：${sellAmount.toFixed(2)} 元</p>
                <p>卖出佣金：${sellFees.commission} 元</p>
                <p>印花税：${sellFees.stampDuty} 元</p>
                <p>过户费：${sellFees.transferFee} 元</p>
                <p>实际所得：${totalRevenue.toFixed(2)} 元</p>
                <h4>盈亏结果：${profit.toFixed(2)} 元 (${((profit/totalCost) * 100).toFixed(2)}%)</h4>
            `;
        }

        function calculateAStockFees(amount, type) {
            // 佣金费用（券商收取）- 最低5元，一般为交易金额的0.025%
            const commission = Math.max(amount * 0.00025, 5);
            
            // 印花税（仅卖出时收取）- 成交金额的0.05%
            const stampDuty = type === 'sell' ? amount * 0.0005 : 0;
            
            // 过户费（上交所/深交所收取）- 成交金额的0.001%
            const transferFee = amount * 0.00001;
            
            return {
                commission: commission.toFixed(2),
                stampDuty: stampDuty.toFixed(2),
                transferFee: transferFee.toFixed(2),
                total: (commission + stampDuty + transferFee).toFixed(2)
            };
        }

        // 使用示例
        function displayFees(tradeAmount) {
            const fees = calculateAStockFees(tradeAmount);
            console.log(`
                交易金额: ${tradeAmount}元
                佣金: ${fees.commission}元
                印花税: ${fees.stampDuty}元
                过户费: ${fees.transferFee}元
                总费用: ${fees.total}元
            `);
        }
    </script>
</body>
</html> 